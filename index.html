<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bengkel Rotorz Garage 17</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
            overflow-x: hidden;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background: var(--primary);
            color: white;
            transition: all 0.3s ease;
            position: fixed;
            height: 100vh;
            z-index: 100;
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
        }
        .sidebar.collapsed {
            width: 70px;
        }
        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo img {
            width: 40px;
            height: 40px;
        }
        .logo-text {
            font-size: 18px;
            font-weight: bold;
            white-space: nowrap;
        }
        .sidebar.collapsed .logo-text {
            display: none;
        }
        .toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        .sidebar-menu {
            padding: 15px 0;
        }
        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: white;
        }
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .menu-item.active {
            background: var(--secondary);
        }
        .menu-item i {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }
        .menu-text {
            white-space: nowrap;
        }
        .sidebar.collapsed .menu-text {
            display: none;
        }
        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 250px;
            transition: all 0.3s ease;
        }
        .sidebar.collapsed ~ .main-content {
            margin-left: 70px;
        }
        .top-nav {
            background: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .content {
            padding: 25px;
        }
        .page-title {
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
        }
        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        .btn-success {
            background: var(--success);
            color: white;
        }
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        .btn-excel {
            background: #217346; /* Warna Excel */
            color: white;
            padding: 8px 12px; /* Sedikit lebih kecil */
        }
        .btn-excel:hover {
            background: #1a5c37; /* Warna hover Excel */
        }
        button:hover {
            opacity: 0.9;
        }
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        .login-box {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header h2 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        .login-logo {
            font-size: 40px;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        /* Dashboard Styles */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        .stat-info h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .stat-info p {
            color: #666;
            font-size: 14px;
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            .sidebar:not(.collapsed) {
                width: 250px;
                z-index: 1000;
            }
            .main-content {
                margin-left: 70px;
            }
            .sidebar:not(.collapsed) ~ .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-tools"></i>
                </div>
                <h2>Bengkel Rotorz Garage 17</h2>
                <p>Silakan masuk ke akun Anda</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">Masuk</button>
            </form>
            <div style="margin-top: 20px; text-align: center;">
                <p>Demo Login:</p>
                <p><strong>Kasir:</strong> kasir / 123</p>
                <p><strong>Owner 1:</strong> owner1 / 123</p>
                <p><strong>Owner 2:</strong> owner2 / 123</p>
            </div>
        </div>
    </div>
    <!-- Main Application -->
    <div id="app" class="container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-tools"></i>
                    <div class="logo-text">Rotorz Garage 17</div>
                </div>
                <button class="toggle-btn" id="toggleSidebar">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="menu-text">Dashboard</span>
                </a>
                <a href="#" class="menu-item" data-page="pembelian">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="menu-text">Pembelian</span>
                </a>
                <a href="#" class="menu-item" data-page="inventory">
                    <i class="fas fa-boxes"></i>
                    <span class="menu-text">Inventory</span>
                </a>
                <a href="#" class="menu-item" data-page="penjualan">
                    <i class="fas fa-cash-register"></i>
                    <span class="menu-text">Penjualan</span>
                </a>
                <a href="#" class="menu-item" data-page="keuangan">
                    <i class="fas fa-chart-line"></i>
                    <span class="menu-text">Keuangan</span>
                </a>
                <a href="#" class="menu-item user-management-item" data-page="userManagement" style="display: none;">
                    <i class="fas fa-users-cog"></i>
                    <span class="menu-text">User Management</span>
                </a>
                <a href="#" class="menu-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="menu-text">Keluar</span>
                </a>
            </div>
        </div>
        <!-- Main Content -->
        <div class="main-content">
            <div class="top-nav">
                <div>
                    <h2 id="currentPageTitle">Dashboard</h2>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <div id="userName">User</div>
                        <div id="userRole" style="font-size: 12px; color: #666;">Role</div>
                    </div>
                </div>
            </div>
            <div class="content">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content">
                    <div class="page-title">
                        <i class="fas fa-tachometer-alt"></i>
                        <h2>Dashboard</h2>
                    </div>
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--secondary);">
                                <i class="fas fa-cash-register"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="pendapatanBulanIni">Rp 0</h3>
                                <p>Pendapatan Bulan Ini</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--success);">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="transaksiBulanIni">0</h3>
                                <p>Transaksi Bulan Ini</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--warning);">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalBarangInventory">0</h3>
                                <p>Total Barang di Inventory</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--danger);">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stokMenipis">0</h3>
                                <p>Stok Menipis</p>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Aktivitas Terbaru</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Nama Customer</th>
                                    <th>Deskripsi</th>
                                    <th>Product</th>
                                    <th>Qty</th>
                                    <th>Total Harga Barang</th>
                                    <th>Biaya Service</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="aktivitasTbody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Pembelian Page -->
                <div id="pembelianPage" class="page-content" style="display: none;">
                    <div class="page-title">
                        <i class="fas fa-shopping-cart"></i>
                        <h2>Pembelian</h2>
                    </div>
                    <div class="card">
                        <h3>Tambah Pembelian Baru</h3>
                        <form id="pembelianForm">
                            <div class="form-group">
                                <label for="tanggalPembelian">Tanggal Pembelian</label>
                                <input type="date" id="tanggalPembelian" required>
                            </div>
                            <div class="form-group">
                                <label for="kategoriBarang">Kategori Barang</label>
                                <select id="kategoriBarang" required>
                                    <option value="">Pilih Kategori</option>
                                    <option value="sparepart">Spare Part</option>
                                    <option value="oli">Oli</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="namaBarang">Nama Barang</label>
                                <input type="text" id="namaBarang" placeholder="Masukkan nama barang" required>
                            </div>
                            <div class="form-group">
                                <label for="hargaBeli">Harga Beli</label>
                                <input type="number" id="hargaBeli" placeholder="Masukkan harga beli" required>
                            </div>
                            <div class="form-group">
                                <label for="hargaJual">Harga Jual</label>
                                <input type="number" id="hargaJual" placeholder="Masukkan harga jual" required>
                            </div>
                            <div class="form-group">
                                <label for="jumlahBarang">Jumlah</label>
                                <input type="number" id="jumlahBarang" placeholder="Masukkan jumlah" required>
                            </div>
                            <div class="form-group">
                                <label for="supplier">Supplier</label>
                                <input type="text" id="supplier" placeholder="Masukkan nama supplier">
                            </div>
                            <button type="submit" class="btn-primary">Simpan Pembelian</button>
                        </form>
                    </div>
                    <div class="card">
                        <h3>Riwayat Pembelian</h3>
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label for="periodeAwalPembelian">Periode Awal</label>
                                <input type="date" id="periodeAwalPembelian">
                            </div>
                            <div>
                                <label for="periodeAkhirPembelian">Periode Akhir</label>
                                <input type="date" id="periodeAkhirPembelian">
                            </div>
                            <div style="align-self: flex-end;">
                                <button class="btn-primary" id="filterPembelianBtn">Filter</button>
                                <button class="btn-excel" id="exportPembelianBtn" title="Export ke Excel">
                                    <i class="fas fa-file-excel"></i>
                                </button>
                            </div>
                        </div>
                        <table id="pembelianTable">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Kategori</th>
                                    <th>Nama Barang</th>
                                    <th>Harga Beli</th>
                                    <th>Jumlah</th>
                                    <th>Total</th>
                                    <th>Supplier</th>
                                </tr>
                            </thead>
                            <tbody id="pembelianTbody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Inventory Page -->
                <div id="inventoryPage" class="page-content" style="display: none;">
                    <div class="page-title">
                        <i class="fas fa-boxes"></i>
                        <h2>Inventory</h2>
                    </div>
                    <div class="card">
                        <h3>Daftar Barang</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Nama Barang</th>
                                    <th>Kategori</th>
                                    <th>Stok</th>
                                    <th>Harga Beli</th>
                                    <th>Harga Jual</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTbody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="card" id="riwayatPenjualanInventoryCard" style="display: none;">
                        <h3>Riwayat Penjualan Barang</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Barang</th>
                                    <th>Qty Terjual</th>
                                    <th>Tanggal Transaksi</th>
                                    <th>Nama Pelanggan</th>
                                </tr>
                            </thead>
                            <tbody id="riwayatPenjualanInventoryTbody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Penjualan Page -->
                <div id="penjualanPage" class="page-content" style="display: none;">
                    <div class="page-title">
                        <i class="fas fa-cash-register"></i>
                        <h2>Penjualan</h2>
                    </div>
                    <div class="card">
                        <h3>Transaksi Baru</h3>
                        <form id="penjualanForm">
                            <div class="form-group">
                                <label for="tanggalPenjualan">Tanggal Penjualan</label>
                                <input type="date" id="tanggalPenjualan" required>
                            </div>
                            <div class="form-group">
                                <label for="jenisTransaksi">Jenis Transaksi</label>
                                <select id="jenisTransaksi" required>
                                    <option value="">Pilih Jenis</option>
                                    <option value="barang">Penjualan Barang</option>
                                    <option value="service">Service</option>
                                    <option value="barang_service">Barang + Service</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="pelanggan">Nama Pelanggan</label>
                                <input type="text" id="pelanggan" placeholder="Masukkan nama pelanggan" required>
                            </div>
                            <div id="barangListContainer">
                                <!-- Item barang akan ditambahkan di sini -->
                                <div class="barang-item">
                                    <div class="form-group">
                                        <label>Barang Dijual</label>
                                        <select class="barang-dijual" required>
                                            <option value="">Pilih Barang</option>
                                            <!-- Opsi akan diisi oleh JavaScript -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Jumlah Barang</label>
                                        <input type="number" class="jumlah-barang-dijual" placeholder="Jumlah barang" min="1" value="1" required>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn-warning" id="tambahBarangBtn">+ Tambah Barang</button>
                            <div class="form-group">
                                <label for="biayaService">Biaya Service</label>
                                <input type="number" id="biayaService" placeholder="Masukkan biaya service" value="0">
                            </div>
                            <div class="form-group">
                                <label for="statusPembayaran">Status Pembayaran</label>
                                <select id="statusPembayaran" required>
                                    <option value="lunas">Lunas</option>
                                    <option value="belum_lunas">Belum Lunas</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-primary">Simpan Transaksi</button>
                        </form>
                    </div>
                    <div class="card">
                        <h3>Riwayat Penjualan</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Pelanggan</th>
                                    <th>Produk</th>
                                    <th>Qty</th>
                                    <th>Biaya Service</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="penjualanTbody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Keuangan Page -->
                <div id="keuanganPage" class="page-content" style="display: none;">
                    <div class="page-title">
                        <i class="fas fa-chart-line"></i>
                        <h2>Keuangan</h2>
                    </div>
                    <div class="card">
                        <h3>Laporan Rugi Laba</h3>
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label for="periodeAwal">Periode Awal</label>
                                <input type="date" id="periodeAwal">
                            </div>
                            <div>
                                <label for="periodeAkhir">Periode Akhir</label>
                                <input type="date" id="periodeAkhir">
                            </div>
                            <div style="align-self: flex-end;">
                                <button class="btn-primary">Tampilkan Laporan</button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody id="labaRugiTbody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="card">
                        <h3>Beban Biaya</h3>
                        <button class="btn-primary" style="margin-bottom: 15px;">Tambah Beban Biaya</button>
                        <table>
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th>Jenis Biaya</th>
                                    <th>Jumlah</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="bebanBiayaTbody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- User Management Page -->
                <div id="userManagementPage" class="page-content" style="display: none;">
                    <div class="page-title">
                        <i class="fas fa-users-cog"></i>
                        <h2>User Management</h2>
                    </div>
                    <div class="card">
                        <h3>Tambah Pengguna Baru</h3>
                        <form id="userForm">
                            <div class="form-group">
                                <label for="namaUser">Nama Lengkap</label>
                                <input type="text" id="namaUser" placeholder="Masukkan nama lengkap" required>
                            </div>
                            <div class="form-group">
                                <label for="usernameUser">Username</label>
                                <input type="text" id="usernameUser" placeholder="Masukkan username" required>
                            </div>
                            <div class="form-group">
                                <label for="passwordUser">Password</label>
                                <input type="password" id="passwordUser" placeholder="Masukkan password" required>
                            </div>
                            <div class="form-group">
                                <label for="roleUser">Role</label>
                                <select id="roleUser" required>
                                    <option value="">Pilih Role</option>
                                    <option value="kasir">Kasir</option>
                                    <option value="owner1">Owner 1</option>
                                    <option value="owner2">Owner 2</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-primary">Tambah Pengguna</button>
                        </form>
                    </div>
                    <div class="card">
                        <h3>Daftar Pengguna</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>Username</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="userTbody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Data Pengguna
        const users = [
            { username: 'kasir', password: '123', name: 'Kasir Demo', role: 'kasir' },
            { username: 'owner1', password: '123', name: 'Owner 1', role: 'owner1' },
            { username: 'owner2', password: '123', name: 'Owner 2', role: 'owner2' }
        ];

        // Data Transaksi & Barang (Contoh)
        let pembelianData = [
            { id: 1, tanggal: '2025-11-10', kategori: 'Spare Part', nama: 'Kampas Rem Belakang', hargaBeli: 85000, hargaJual: 120000, jumlah: 2, total: 170000, supplier: 'PT. Sinar Jaya' },
            { id: 2, tanggal: '2025-11-08', kategori: 'Oli', nama: 'Oli Mesin Mobil 1L', hargaBeli: 65000, hargaJual: 95000, jumlah: 10, total: 650000, supplier: 'CV. Mitra Sejahtera' }
        ];

        let inventoryData = [
            { kode: 'SP001', nama: 'Kampas Rem Belakang', kategori: 'Spare Part', stok: 15, hargaBeli: 85000, hargaJual: 120000 },
            { kode: 'OL001', nama: 'Oli Mesin Mobil 1L', kategori: 'Oli', stok: 25, hargaBeli: 65000, hargaJual: 95000 },
            { kode: 'SP002', nama: 'Busi Motor', kategori: 'Spare Part', stok: 30, hargaBeli: 25000, hargaJual: 40000 }
        ];

        let penjualanData = [
            { id: 1, tanggal: '2025-11-15', pelanggan: 'Budi Santoso', jenis: 'Service', barang: [], qty: [], biayaService: 350000, total: 350000, status: 'lunas' },
            { id: 2, tanggal: '2025-11-14', pelanggan: 'Sari Indah', jenis: 'Barang', barang: [{kode: 'OL001', nama: 'Oli Mesin Mobil 1L', qty: 1}], qty: [1], biayaService: 0, total: 95000, status: 'lunas' },
            { id: 3, tanggal: '2025-11-13', pelanggan: 'Andi Wijaya', jenis: 'Barang + Service', barang: [{kode: 'SP001', nama: 'Kampas Rem Belakang', qty: 1}], qty: [1], biayaService: 200000, total: 320000, status: 'belum_lunas' }
        ];

        let bebanBiayaData = [
            { id: 1, tanggal: '2025-11-10', keterangan: 'Biaya Listrik', jenis: 'Operasional', jumlah: 850000 },
            { id: 2, tanggal: '2025-11-05', keterangan: 'Gaji Karyawan', jenis: 'Operasional', jumlah: 5000000 },
            { id: 3, tanggal: '2025-11-01', keterangan: 'Biaya Sewa Tempat', jenis: 'Operasional', jumlah: 3500000 }
        ];

        // Variabel Global
        let currentUser = null;
        let currentPage = 'dashboard';

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const app = document.getElementById('app');
        const loginForm = document.getElementById('loginForm');
        const sidebar = document.getElementById('sidebar');
        const toggleSidebar = document.getElementById('toggleSidebar');
        const menuItems = document.querySelectorAll('.menu-item');
        const pageContents = document.querySelectorAll('.page-content');
        const currentPageTitle = document.getElementById('currentPageTitle');
        const userName = document.getElementById('userName');
        const userRole = document.getElementById('userRole');
        const userAvatar = document.getElementById('userAvatar');
        const logoutBtn = document.getElementById('logoutBtn');
        const userManagementItem = document.querySelector('.user-management-item');
        // Elements untuk Pembelian
        const filterPembelianBtn = document.getElementById('filterPembelianBtn');
        const exportPembelianBtn = document.getElementById('exportPembelianBtn');
        const periodeAwalPembelian = document.getElementById('periodeAwalPembelian');
        const periodeAkhirPembelian = document.getElementById('periodeAkhirPembelian');
        const pembelianTbody = document.getElementById('pembelianTbody');
        const pembelianTable = document.getElementById('pembelianTable');
        // Elements untuk Penjualan
        const tambahBarangBtn = document.getElementById('tambahBarangBtn');
        const barangListContainer = document.getElementById('barangListContainer');
        const penjualanTbody = document.getElementById('penjualanTbody');
        const aktivitasTbody = document.getElementById('aktivitasTbody');
        // Elements untuk Inventory
        const inventoryTbody = document.getElementById('inventoryTbody');
        const riwayatPenjualanInventoryCard = document.getElementById('riwayatPenjualanInventoryCard');
        const riwayatPenjualanInventoryTbody = document.getElementById('riwayatPenjualanInventoryTbody');
        // Elements untuk Keuangan
        const labaRugiTbody = document.getElementById('labaRugiTbody');
        const bebanBiayaTbody = document.getElementById('bebanBiayaTbody');
        // Elements untuk User Management
        const userTbody = document.getElementById('userTbody');

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Set tanggal hari ini untuk form
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalPembelian').value = today;
            document.getElementById('tanggalPenjualan').value = today;
            document.getElementById('periodeAwal').value = today;
            document.getElementById('periodeAkhir').value = today;
            // Set tanggal default filter ke bulan ini
            const startOfMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
            periodeAwalPembelian.value = startOfMonth;
            periodeAkhirPembelian.value = today;

            // Login Form
            loginForm.addEventListener('submit', handleLogin);

            // Toggle Sidebar
            toggleSidebar.addEventListener('click', toggleSidebarFunc);

            // Menu Items
            menuItems.forEach(item => {
                if (item.id !== 'logoutBtn') {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        // Cek akses sebelum mengganti halaman
                        const page = this.getAttribute('data-page');
                        if (checkAccess(page)) {
                            changePage(page);
                        } else {
                            alert('Akses ditolak. Anda tidak memiliki izin untuk mengakses menu ini.');
                        }
                    });
                }
            });

            // Logout
            logoutBtn.addEventListener('click', handleLogout);

            // Filter Pembelian
            filterPembelianBtn.addEventListener('click', applyPembelianFilter);
            // Export Pembelian
            exportPembelianBtn.addEventListener('click', exportToExcel);

            // Penjualan Form
            tambahBarangBtn.addEventListener('click', addBarangItem);
            document.getElementById('penjualanForm').addEventListener('submit', handlePenjualanSubmit);

            // Pembelian Form
            document.getElementById('pembelianForm').addEventListener('submit', handlePembelianSubmit);

            // Inisialisasi isi form barang
            populateBarangOptions();
        });

        // Functions
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                showApp();
            } else {
                alert('Username atau password salah!');
            }
        }

        function showApp() {
            loginPage.style.display = 'none';
            app.style.display = 'flex';
            // Update UI berdasarkan role user
            updateUIForUser();
            // Tampilkan halaman dashboard jika user memiliki akses
            if (checkAccess('dashboard')) {
                changePage('dashboard');
            } else {
                // Jika tidak bisa akses dashboard (misalnya kasir), redirect ke penjualan
                changePage('penjualan');
            }
        }

        function checkAccess(page) {
            if (!currentUser) return false;
            const role = currentUser.role;
            switch (page) {
                case 'dashboard':
                case 'pembelian':
                case 'keuangan':
                    return role === 'owner1' || role === 'owner2';
                case 'userManagement':
                    return role === 'owner2';
                case 'inventory':
                case 'penjualan':
                    return role === 'kasir' || role === 'owner1' || role === 'owner2';
                default:
                    return false;
            }
        }

        function updateUIForUser() {
            if (!currentUser) return;

            // Update info user
            userName.textContent = currentUser.name;
            userRole.textContent = formatRole(currentUser.role);
            userAvatar.textContent = currentUser.name.charAt(0);

            // Tampilkan/sembunyikan menu berdasarkan role
            if (currentUser.role === 'owner2') {
                userManagementItem.style.display = 'flex';
            } else {
                userManagementItem.style.display = 'none';
            }

            // Sembunyikan menu tertentu untuk kasir
            if (currentUser.role === 'kasir') {
                document.querySelector('[data-page="dashboard"]').style.display = 'none';
                document.querySelector('[data-page="pembelian"]').style.display = 'none';
                document.querySelector('[data-page="keuangan"]').style.display = 'none';
            } else {
                // Jika bukan kasir, tampilkan semua menu
                document.querySelector('[data-page="dashboard"]').style.display = 'flex';
                document.querySelector('[data-page="pembelian"]').style.display = 'flex';
                document.querySelector('[data-page="keuangan"]').style.display = 'flex';
            }

            // Sembunyikan harga beli untuk kasir
            if (currentUser.role === 'kasir') {
                document.querySelectorAll('#inventoryTbody td:nth-child(5)').forEach(td => {
                    td.textContent = '***';
                });
            }

            // Sembunyikan tombol edit harga untuk bukan owner2
            document.querySelectorAll('.edit-harga-btn').forEach(btn => {
                if (currentUser.role === 'owner2') {
                    btn.style.display = 'inline-block';
                } else {
                    btn.style.display = 'none';
                }
            });

            // Sembunyikan tab Riwayat Penjualan Inventory untuk Kasir
            if (currentUser.role === 'kasir') {
                riwayatPenjualanInventoryCard.style.display = 'none';
            } else {
                riwayatPenjualanInventoryCard.style.display = 'block';
            }
        }

        function formatRole(role) {
            switch(role) {
                case 'kasir': return 'Kasir';
                case 'owner1': return 'Owner 1';
                case 'owner2': return 'Owner 2';
                default: return role;
            }
        }

        function toggleSidebarFunc() {
            sidebar.classList.toggle('collapsed');
        }

        function changePage(page) {
            // Update menu aktif
            menuItems.forEach(item => {
                if (item.getAttribute('data-page') === page) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            // Tampilkan halaman yang dipilih
            pageContents.forEach(content => {
                if (content.id === `${page}Page`) {
                    content.style.display = 'block';
                } else {
                    content.style.display = 'none';
                }
            });
            // Update judul halaman
            currentPageTitle.textContent = getPageTitle(page);
            currentPage = page;

            // Render ulang konten berdasarkan role dan halaman
            if (page === 'dashboard') renderDashboard();
            if (page === 'pembelian') renderPembelian();
            if (page === 'inventory') renderInventory();
            if (page === 'penjualan') renderPenjualan();
            if (page === 'keuangan') renderKeuangan();
            if (page === 'userManagement') renderUserManagement();

            // Terapkan perubahan UI sekali lagi setelah render
            updateUIForUser();
        }

        function getPageTitle(page) {
            switch(page) {
                case 'dashboard': return 'Dashboard';
                case 'pembelian': return 'Pembelian';
                case 'inventory': return 'Inventory';
                case 'penjualan': return 'Penjualan';
                case 'keuangan': return 'Keuangan';
                case 'userManagement': return 'User Management';
                default: return 'Dashboard';
            }
        }

        function handleLogout(e) {
            e.preventDefault();
            if (confirm('Apakah Anda yakin ingin keluar?')) {
                currentUser = null; // Reset user
                app.style.display = 'none'; // Sembunyikan app
                loginPage.style.display = 'flex'; // Tampilkan login
                loginForm.reset(); // Reset form login
            }
        }

        // --- Fungsi Pembelian ---
        function handlePembelianSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const tanggal = document.getElementById('tanggalPembelian').value;
            const kategori = document.getElementById('kategoriBarang').value;
            const nama = document.getElementById('namaBarang').value;
            const hargaBeli = parseInt(document.getElementById('hargaBeli').value);
            const hargaJual = parseInt(document.getElementById('hargaJual').value);
            const jumlah = parseInt(document.getElementById('jumlahBarang').value);
            const supplier = document.getElementById('supplier').value;
            
            const newPembelian = {
                id: pembelianData.length + 1,
                tanggal: tanggal,
                kategori: kategori,
                nama: nama,
                hargaBeli: hargaBeli,
                hargaJual: hargaJual,
                jumlah: jumlah,
                total: hargaBeli * jumlah,
                supplier: supplier
            };
            
            pembelianData.push(newPembelian);
            
            // Tambahkan ke inventory jika belum ada
            const existingItem = inventoryData.find(item => item.nama === nama);
            if (existingItem) {
                existingItem.stok += jumlah;
            } else {
                const kode = generateKodeBarang(kategori);
                inventoryData.push({
                    kode: kode,
                    nama: nama,
                    kategori: kategori,
                    stok: jumlah,
                    hargaBeli: hargaBeli,
                    hargaJual: hargaJual
                });
            }
            
            e.target.reset();
            document.getElementById('tanggalPembelian').value = new Date().toISOString().split('T')[0];
            
            if (currentPage === 'pembelian') renderPembelian();
            if (currentPage === 'inventory') renderInventory();
            if (currentPage === 'dashboard') renderDashboard();
        }
        
        function generateKodeBarang(kategori) {
            const prefix = kategori === 'sparepart' ? 'SP' : 'OL';
            const count = inventoryData.filter(item => item.kategori === kategori).length + 1;
            return `${prefix}${count.toString().padStart(3, '0')}`;
        }

        function applyPembelianFilter() {
            const startDate = periodeAwalPembelian.value;
            const endDate = periodeAkhirPembelian.value;

            const rows = pembelianTbody.querySelectorAll('tr');
            rows.forEach(row => {
                const tanggalCell = row.cells[0]; // Kolom Tanggal
                const tanggal = tanggalCell.textContent;

                // Konversi ke format YYYY-MM-DD jika belum (diasumsikan format input)
                const dateObj = new Date(tanggal);
                const formattedDate = dateObj.toISOString().split('T')[0];

                if ((startDate === '' || formattedDate >= startDate) && (endDate === '' || formattedDate <= endDate)) {
                    row.style.display = ''; // Tampilkan baris
                } else {
                    row.style.display = 'none'; // Sembunyikan baris
                }
            });
        }

        function exportToExcel() {
            // Ambil data yang ditampilkan di tabel setelah difilter
            let csvContent = "text/csv;charset=utf-8,";

            // Tambahkan header
            const headers = Array.from(pembelianTable.querySelectorAll('th')).map(th => th.textContent);
            csvContent += headers.join(",") + "\n";

            // Tambahkan baris data yang terlihat
            const rows = pembelianTbody.querySelectorAll('tr');
            rows.forEach(row => {
                if (row.style.display !== 'none') { // Hanya proses baris yang terlihat
                    const rowData = Array.from(row.querySelectorAll('td')).map(td => `"${td.textContent}"`);
                    csvContent += rowData.join(",") + "\n";
                }
            });

            // Buat elemen link untuk download
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "riwayat_pembelian.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- Fungsi Penjualan ---
        function populateBarangOptions() {
            const container = document.getElementById('barangListContainer');
            const selects = container.querySelectorAll('.barang-dijual');
            selects.forEach(select => {
                select.innerHTML = '<option value="">Pilih Barang</option>';
                inventoryData.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.kode;
                    option.textContent = `${item.nama} (Stok: ${item.stok})`;
                    select.appendChild(option);
                });
            });
        }

        function addBarangItem() {
            const container = document.getElementById('barangListContainer');
            const newItem = document.createElement('div');
            newItem.className = 'barang-item';
            newItem.innerHTML = `
                <div class="form-group">
                    <label>Barang Dijual</label>
                    <select class="barang-dijual" required>
                        <option value="">Pilih Barang</option>
                        <!-- Opsi akan diisi oleh JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Jumlah Barang</label>
                    <input type="number" class="jumlah-barang-dijual" placeholder="Jumlah barang" min="1" value="1" required>
                </div>
                <button type="button" class="btn-danger remove-barang">Hapus</button>
            `;
            container.appendChild(newItem);
            populateBarangOptions(); // Update opsi untuk item baru
            newItem.querySelector('.remove-barang').addEventListener('click', function() {
                this.parentElement.remove();
            });
        }

        function handlePenjualanSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const jenisTransaksi = document.getElementById('jenisTransaksi').value;
            const biayaService = parseInt(document.getElementById('biayaService').value) || 0;

            // Ambil data barang dari semua item
            const barangItems = e.target.querySelectorAll('.barang-item');
            let barang = [];
            let totalBarang = 0;
            let allValid = true;

            barangItems.forEach(item => {
                const barangSelect = item.querySelector('.barang-dijual');
                const qtyInput = item.querySelector('.jumlah-barang-dijual');
                const kode = barangSelect.value;
                const qty = parseInt(qtyInput.value);

                if (kode && qty > 0) {
                    const itemData = inventoryData.find(i => i.kode === kode);
                    if (itemData && itemData.stok >= qty) {
                        barang.push({ kode: itemData.kode, nama: itemData.nama, qty: qty });
                        totalBarang += itemData.hargaJual * qty;
                    } else {
                        alert(`Stok tidak mencukupi untuk ${itemData.nama} atau barang tidak ditemukan.`);
                        allValid = false;
                    }
                }
            });

            if (!allValid) return;

            const total = totalBarang + biayaService;
            const newPenjualan = {
                id: penjualanData.length + 1,
                tanggal: document.getElementById('tanggalPenjualan').value,
                pelanggan: document.getElementById('pelanggan').value,
                jenis: jenisTransaksi,
                barang: barang,
                qty: barang.map(b => b.qty),
                biayaService: biayaService,
                total: total,
                status: document.getElementById('statusPembayaran').value
            };

            if (barang.length > 0) { // Jika ada barang yang dijual, update stok
                barang.forEach(b => {
                    const item = inventoryData.find(i => i.kode === b.kode);
                    if (item) {
                        item.stok -= b.qty;
                    }
                });
            }

            penjualanData.push(newPenjualan);
            e.target.reset();
            document.getElementById('tanggalPenjualan').value = new Date().toISOString().split('T')[0];
            document.getElementById('statusPembayaran').value = 'lunas';
            document.getElementById('biayaService').value = 0;
            // Hapus semua item barang kecuali yang pertama
            while (barangListContainer.children.length > 1) {
                barangListContainer.removeChild(barangListContainer.lastChild);
            }
            populateBarangOptions(); // Reset opsi barang

            if (currentPage === 'penjualan') renderPenjualan();
            if (currentPage === 'dashboard') renderDashboard();
            if (currentPage === 'inventory') renderInventory(); // Untuk update stok dan riwayat
        }

        // --- Fungsi Inventory ---
        function renderInventory() {
            inventoryTbody.innerHTML = '';
            inventoryData.forEach(item => {
                const tr = document.createElement('tr');
                const editHargaBtn = currentUser.role === 'owner2' ? '<button class="btn-warning edit-harga-btn">Edit Harga</button>' : '';
                tr.innerHTML = `
                    <td>${item.kode}</td>
                    <td>${item.nama}</td>
                    <td>${item.kategori}</td>
                    <td>${item.stok}</td>
                    <td>${currentUser.role === 'kasir' ? '***' : 'Rp ' + item.hargaBeli.toLocaleString('id-ID')}</td>
                    <td>Rp ${item.hargaJual.toLocaleString('id-ID')}</td>
                    <td class="action-buttons">
                        ${editHargaBtn}
                        <button class="btn-primary">Detail</button>
                    </td>
                `;
                inventoryTbody.appendChild(tr);
            });

            // Render Riwayat Penjualan Inventory (untuk Owner 1 & 2)
            if (currentUser.role === 'owner1' || currentUser.role === 'owner2') {
                riwayatPenjualanInventoryTbody.innerHTML = '';
                penjualanData.forEach(t => {
                    if (t.barang && t.barang.length > 0) { // Hanya transaksi dengan barang
                        t.barang.forEach(b => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td>${b.nama}</td>
                                <td>${b.qty}</td>
                                <td>${t.tanggal}</td>
                                <td>${t.pelanggan}</td>
                            `;
                            riwayatPenjualanInventoryTbody.appendChild(tr);
                        });
                    }
                });
            }
        }

        // --- Fungsi Umum Render ---
        function renderDashboard() {
            // Update Stats Cards (contoh sederhana)
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const penjualanBulanIni = penjualanData.filter(t => {
                const date = new Date(t.tanggal);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            const totalPendapatan = penjualanBulanIni.reduce((sum, t) => sum + t.total, 0);
            
            document.getElementById('pendapatanBulanIni').textContent = 'Rp ' + totalPendapatan.toLocaleString('id-ID');
            document.getElementById('transaksiBulanIni').textContent = penjualanBulanIni.length;
            document.getElementById('totalBarangInventory').textContent = inventoryData.reduce((sum, item) => sum + item.stok, 0);
            document.getElementById('stokMenipis').textContent = inventoryData.filter(item => item.stok < 10).length; // Contoh ambang batas

            // Render Aktivitas Terbaru
            aktivitasTbody.innerHTML = '';
            // Ambil 5 transaksi terbaru dari penjualan
            const latestTransactions = [...penjualanData].sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal)).slice(0, 5);
            latestTransactions.forEach(t => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${t.tanggal}</td>
                    <td>${t.pelanggan || '-'}</td>
                    <td>${t.jenis}</td>
                    <td>${t.barang.map(b => b.nama).join(', ') || '-'}</td>
                    <td>${t.qty.reduce((sum, q) => sum + q, 0)}</td>
                    <td>Rp ${(t.total - t.biayaService).toLocaleString('id-ID')}</td>
                    <td>Rp ${t.biayaService.toLocaleString('id-ID')}</td>
                    <td>Rp ${t.total.toLocaleString('id-ID')}</td>
                `;
                aktivitasTbody.appendChild(tr);
            });
        }

        function renderPembelian() {
            pembelianTbody.innerHTML = '';
            pembelianData.forEach(p => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${p.tanggal}</td>
                    <td>${p.kategori}</td>
                    <td>${p.nama}</td>
                    <td>Rp ${p.hargaBeli.toLocaleString('id-ID')}</td>
                    <td>${p.jumlah}</td>
                    <td>Rp ${p.total.toLocaleString('id-ID')}</td>
                    <td>${p.supplier}</td>
                `;
                pembelianTbody.appendChild(tr);
            });
        }

        function renderPenjualan() {
            penjualanTbody.innerHTML = '';
            penjualanData.forEach(t => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${t.tanggal}</td>
                    <td>${t.pelanggan || '-'}</td>
                    <td>${t.barang.map(b => b.nama).join(', ') || '-'}</td>
                    <td>${t.qty.reduce((sum, q) => sum + q, 0)}</td>
                    <td>Rp ${t.biayaService.toLocaleString('id-ID')}</td>
                    <td>Rp ${t.total.toLocaleString('id-ID')}</td>
                    <td>${t.status === 'lunas' ? 'Lunas' : 'Belum Lunas'}</td>
                    <td class="action-buttons">
                        <button class="btn-primary">Detail</button>
                        ${t.status === 'belum_lunas' ? '<button class="btn-success">Bayar</button>' : ''}
                    </td>
                `;
                penjualanTbody.appendChild(tr);
            });
        }

        function renderKeuangan() {
            // Render Beban Biaya
            bebanBiayaTbody.innerHTML = '';
            bebanBiayaData.forEach(b => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${b.tanggal}</td>
                    <td>${b.keterangan}</td>
                    <td>${b.jenis}</td>
                    <td>Rp ${b.jumlah.toLocaleString('id-ID')}</td>
                    <td class="action-buttons">
                        <button class="btn-primary">Edit</button>
                        <button class="btn-danger">Hapus</button>
                    </td>
                `;
                bebanBiayaTbody.appendChild(tr);
            });

            // Render Laporan Rugi Laba
            labaRugiTbody.innerHTML = '';
            // Pendapatan
            const totalPenjualan = penjualanData.reduce((sum, t) => sum + (t.jenis !== 'service' ? t.total - t.biayaService : 0), 0); // Hanya total barang
            const totalServiceBengkel = penjualanData.reduce((sum, t) => sum + (t.biayaService * 0.3), 0); // 30% dari biaya service
            const totalPendapatan = totalPenjualan + totalServiceBengkel;

            // Beban
            const totalHPP = pembelianData.reduce((sum, p) => sum + p.total, 0); // Harga Pokok Penjualan (contoh sederhana)
            const totalServicePekerja = penjualanData.reduce((sum, t) => sum + (t.biayaService * 0.7), 0); // 70% dari biaya service
            const totalBebanOperasional = bebanBiayaData.reduce((sum, b) => sum + b.jumlah, 0);
            const totalBeban = totalHPP + totalServicePekerja + totalBebanOperasional;

            // Laba/Rugi
            const labaRugi = totalPendapatan - totalBeban;

            // Perbaikan: Template string yang benar
            labaRugiTbody.innerHTML = `
                <tr><td><strong>Pendapatan</strong></td><td></td></tr>
                <tr><td style="padding-left: 20px;">Pendapatan Penjualan Barang</td><td>Rp ${totalPenjualan.toLocaleString('id-ID')}</td></tr>
                <tr><td style="padding-left: 20px;">Pendapatan Service (30%)</td><td>Rp ${totalServiceBengkel.toLocaleString('id-ID')}</td></tr>
                <tr><td><strong>Total Pendapatan</strong></td><td><strong>Rp ${totalPendapatan.toLocaleString('id-ID')}</strong></td></tr>
                <tr><td><strong>Beban Biaya</strong></td><td></td></tr>
                <tr><td style="padding-left: 20px;">Harga Pokok Penjualan</td><td>Rp ${totalHPP.toLocaleString('id-ID')}</td></tr>
                <tr><td style="padding-left: 20px;">Biaya Service (70%)</td><td>Rp ${totalServicePekerja.toLocaleString('id-ID')}</td></tr>
                <tr><td style="padding-left: 20px;">Biaya Operasional</td><td>Rp ${totalBebanOperasional.toLocaleString('id-ID')}</td></tr>
                <tr><td><strong>Total Beban</strong></td><td><strong>Rp ${totalBeban.toLocaleString('id-ID')}</strong></td></tr>
                <tr><td><strong>Laba/Rugi</strong></td><td><strong style="color: ${labaRugi >= 0 ? 'var(--success)' : 'var(--danger)'}">Rp ${labaRugi.toLocaleString('id-ID')}</strong></td></tr>
            `;
        }

        function renderUserManagement() {
            userTbody.innerHTML = '';
            users.forEach(u => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${u.name}</td>
                    <td>${u.username}</td>
                    <td>${formatRole(u.role)}</td>
                    <td>Aktif</td>
                    <td class="action-buttons">
                        <button class="btn-warning">Edit</button>
                        <button class="btn-danger">Nonaktifkan</button>
                    </td>
                `;
                userTbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>
